{"version":3,"sources":["search.es6"],"names":[],"mappings":"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","file":"search.js","sourcesContent":["/**\n * Created by xiangran.kong on 16/08/12.\n */\nimport {getUnit, eventUnit, cookieUnit} from './unit/unit.js';\n\n!function(window, document, $){\n\n    /**\n     * 读取搜索历史\n     * */\n    $.readSearchHistory = function (box) {\n        if(!window.localStorage) return false;\n        var sHis = '',\n            html = '',\n            sBox = $(box);\n        if('sHis' in window.localStorage){\n            sHis = window.localStorage.sHis;\n\n            // 最新的记录在最上边\n            sHis = sHis.split(\" \").reverse();\n            for(var i=0; i<sHis.length; i++){\n                html += '<li><a href=\\\"search-result.html?searchText=' + sHis[i] + '\\\">' + sHis[i] + '</a></li>';\n            }\n        }else{\n            html = '<li><span>暂无历史搜索!</span></li>'\n        }\n        sBox.append(html);\n    };\n\n    /**\n     * 存储搜索历史,接收字符串,记录以字符串的形式存储在localStorage中,记录之间以空白间隔\n     * */\n    $.saveSearchHistory = function (text) {\n        let sHis = ('sHis' in window.localStorage) ? window.localStorage.sHis : '';\n        if(typeof text !== 'string') return false;\n        let tempStr = text.replace(' ', '');\n        tempStr = tempStr.replace(/<[^<>]+>/g, '');\n        if(sHis.indexOf(' ') !== -1 || sHis !== ''){\n            let tempSHis;\n            tempSHis = sHis.split(' ');\n            for(let i=0; i<tempSHis.length; i++){\n                if(tempStr == tempSHis[i]) return false;\n            }\n        }\n        tempStr = ' ' + tempStr;\n        sHis = sHis + tempStr;\n        sHis = sHis.replace(/(^\\s*)/g, '');\n        window.localStorage.sHis = sHis;\n    };\n\n    if(getUnit.cls('search-box751')){\n        // 加载历史记录\n        $.readSearchHistory('#J_searchHisShowBox');\n        // 清除历史记录\n        $('#J_clearSearchHistory').on('tap', function () {\n            if(!window.localStorage || !('sHis' in window.localStorage)){\n                $.pop({\n                    type: 'tips',\n                    hideTimes: 2000,\n                    message: '清除失败!'\n                });\n            }\n            window.localStorage.removeItem('sHis');\n            if(!window.localStorage.sHis){\n                // 弹出,清除成功\n                $.pop({\n                    type: 'tips',\n                    hideTimes: 2000,\n                    message: '搜索记录清除成功!'\n                });\n                setTimeout(function(){\n                    window.location.reload();\n                },2000);\n\n            }else{\n                $.pop({\n                    type: 'tips',\n                    hideTimes: 2000,\n                    message: '清除失败!'\n                });\n            }\n        });\n    }\n\n    if(getUnit.cls('search-box751') || getUnit.cls('search-result-box751')){\n        // searchInput\n        $('.J_searchInput').bind('keyup', function (e) {\n            var searchText = $('.J_searchInput').val(),\n                sugBox = $('.suggest751'),\n                tabBox = $('.m-tab');\n            // 回车,跳转搜索结果页面\n            if(e.keyCode == '13'){\n                var url = 'search-result.html?searchText=' + searchText;\n                window.location = url;\n\n                // 存历史记录\n                $.saveSearchHistory(searchText);\n            }else{\n                // Ajax\n                $.ajax({\n                    url: searchHistoryUrl,\n                    type: 'post',\n                    data: {'search': searchText},\n                    dataType: 'json', \n                    success: function (data) {\n                        var html = '',\n                            cate = '';\n                        for(var i in data.keywords){\n                            html += '<li><a href=\\\"search-result.html?searchText=' + data.keywords[i] + '\\\">' + data.keywords[i] + '</a></li>';\n                        }\n\n                        for(var j in data.category){\n                            cate += '<li><a href=\\\"search-result.html?searchText=' + searchText + '&searchCategory=' + data.category[j] + '\\\">在<span>' + data.category[j]+ '</span>中搜索:' + searchText + '</a></li>';\n                        }\n                        sugBox.html(cate).append(html);\n                    }\n                });\n\n                tabBox.hide();\n                sugBox.show();\n            }\n        });\n    }\n\n}(window, window.document, Zepto);\n"]}