<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>注册</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<header class="l-head">
    <button type="button" class="back" onclick="history.go(-1)"><span class="icon icon-back"></span></button>
    <h2 class="title">注册</h2>
</header>
<div class="l-content">
    <div class="reg-box751">
        <form action="" class="m-form" id="J_Register">
            <p class="m-form-item">
                <span class="icon icon-phone item-label"></span>
                <input type="tel" class="item-input J_Verify929" id="J_Phone" data-verify="{required:true, type:tel}" placeholder="手机号码">
            </p>
            <p class="m-form-item">
                <span class="icon icon-key item-label"></span>
                <input type="text" class="item-input J_Verify929" id="J_PhoneCode" data-verify="{required:true}" placeholder="图片验证码">
                <span class="code929"><img src="img/10.png" alt=""></span>
            </p>
            <p class="m-form-item">
                <span class="icon icon-key item-label"></span>
                <button type="button" disabled class="btn btn-disabled item-btn" id="J_CodeBtn"  >获取验证码</button>
                <input type="text" class="item-input J_Verify929" data-verify="{required:true}" placeholder="验证码">
            </p>
            <p class="m-form-item">
                <span class="icon icon-earth item-label"></span>
                <input type="text" class="item-input" placeholder="Nationality" disabled id="J_ChooseNationality">
            </p>
            <p class="m-form-item">
                <span class="icon icon-lock-off item-label"></span>
                <span class="icon icon-eye-close item-icon"></span>
                <input type="password" class="item-input J_Verify929" data-verify="{required:true}" placeholder="输入密码">
            </p>

            <label for="J_ConfirmFieldsTerms" class="confirm-fields-terms751"><input id="J_ConfirmFieldsTerms" type="checkbox"  checked class="checkbox-square">我已阅读并同意<a href="#">甫田网服务条款</a></label>
            <button type="button" disabled class="btn btn-radius J_SubmitBtn">注册</button>
            <a class="login-account-link751" href="login.html">已有账号？去登录！</a>
        </form>
    </div>
</div>

<!--国籍选择，独立模块-->
<div class="m-nationality" id="J_Nationality">
    <header class="l-head">
        <button type="button" class="back" data-js="J_GoBack" ><span class="icon icon-back"  data-js="J_GoBack"></span></button>
        <h2 class="title">Country</h2>
    </header>
    <div class="l-content country-list-box751">
        <ul class="country-ab751">
            <li>#</li>
            <li><a href="#NA">A</a></li>
            <li><a href="#NB">B</a></li>
            <li><a href="#NC">C</a></li>
            <li><a href="#ND">D</a></li>
            <li><a href="#NE">E</a></li>
            <li><a href="#NF">F</a></li>
            <li><a href="#NG">G</a></li>
            <li><a href="#NH">H</a></li>
            <li><a href="#NI">I</a></li>
            <li><a href="#NJ">J</a></li>
            <li><a href="#NK">K</a></li>
            <li><a href="#NL">L</a></li>
        </ul>
        <dl>
            <dt class="floor country-item751" id="NA">A</dt>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan1</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan3</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan2</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan3</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan4</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan5</dd>
        </dl>
        <dl>
            <dt class="floor country-item751" id="NB">B</dt>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
        </dl>
        <dl>
            <dt class="floor country-item751" id="NC">C</dt>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
        </dl>
        <dl>
            <dt class="floor country-item751" id="ND">D</dt>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
            <dd class="country-item751" data-country="" data-js="J_ChooseItem">Afghanistan</dd>
        </dl>
    </div>
</div>
<script src="../dist/js/common.js?v=1.0.1"></script>
<script src="../dist/js/user.js?v=1.0.1"></script>
<script>
    $(function(){
        //验证码是否可点击
        var $phone = $('#J_Phone'),
            $code = $('#J_PhoneCode'),
            $btn = $('#J_CodeBtn');
        $('#J_Register').bind('keyup change', function(event){
            if(/^[0-9]{11}$/.test($phone.val()) && $code.val()!='' && !$btn.data('test')){
                $btn.removeClass('btn-disabled').removeAttr('disabled');
            }else{
                $btn.addClass('btn-disabled').attr('disabled','disabled');
            }
        });

        //获取验证码
        $btn.on('tap', function(){
            var ph = $('#J_Phone').val(),
                useType = 'register',
                code = $('#J_PhoneCode').val();
            $.ajax({
                url:"<{base_url()}><{$data['lang']}>/interact/sendSmsCode",
                type: 'POST',
                data: {Code: code, phone: ph, confirm: confirm, useType: useType},
                dataType: 'JSON',
                success: function(d){
                    d = JSON.parse(d);
                    if(d.code == 200){
                        var countDown = 60;
                        $btn.addClass('btn-disabled').attr('disabled', 'disabled');
                        function count(){
                            $btn.data({'test':true});
                            if(countDown == 0){
                                $btn.data({'test':false});
                                $btn.removeClass('btn-disabled').removeAttr('disabled');
                                $btn.html('获取验证码');
                                return false;
                            }else{
                                $btn.html(countDown + 's');
                                countDown--;
                            }
                            setTimeout(function(){
                                count();
                            }, 1000);
                        }
                        count();
                    }else if(d.code == 401){
                        $.pop({
                            type: 'tips',
                            hideTimes: 2000,
                            message: d.msg
                        });
                        return false;
                    }
                }
            })
        });

        // 刷新图形验证码
        $('.J_refreshCaptcha').on('tap', function(){
            var t = $(this);
            $.ajax({
                url: '',
                type: 'POST',
                data: '',
                success: function(data){
                    // 假数据，返回图形验证码的URL
                    data = {
                        captchaUrl: 'http://localhost/html5/captcha/1470900381.1369.jpg'
                    };
                    if(data.captchaUrl) {
                        t.find('img').attr('src', data.captchaUrl);
                    }
                }
            })
        });

        //点击提交按钮
        $('.J_SubmitBtn').bind('touchstart', function(event){
            var regData = {
                phone: $('#J_Phone').val(),
                smsCode: $('#J_SmsCode').val(),
                nationality: $('#J_Nationality').val() ? $('#J_Nationality').val() : null,
                email: $('#J_Email').val() ? $('#J_Email').val() : null,
                password: $('#J_Password').val(),
                confirm: $('#J_Password').val(),
                regFrom: 'html5'
            };
            $.ajax({
                url: "<{base_url()}><{$data['lang']}>/interact/register",
                data: regData,
                type: 'POST',
                beforeSend: function(){
                    //检查所有表单
                    if($.verify.check()){
                        event.target.setAttribute('disabled', 'disabled');
                        event.target.innerHTML = '注册中...';
                        return true;
                    }else{
                        return false;
                    }
                },
                success: function(data){
                    data = JSON.parse(data);
                    if(data.code == 200){
                        $.pop({
                            type: 'tips',
                            hideTimes: 2000,
                            message: data.msg,
                            callback: function(){ // 注册成功,跳转到我的账户
                                window.location = "<{base_url()}><{$data['lang']}>/fields/account";
                            }
                        });
                    }else{
                        $.pop({
                            type: 'tips',
                            hideTimes: 2000,
                            message: data.msg
                        });
                        return false;
                    }

                    event.target.removeAttribute('disabled');
                    event.target.innerHTML = '注册';
                }
            });
        });

        //必选点击
        $('#J_ConfirmFieldsTerms').on('tap', function(){
            $('.J_Verify929').eq(0).trigger('keyup');
        });
        //选择国籍
        $.ChooseListInit('J_ChooseNationality','J_Nationality');

        //查看密码
        $.verify.lookover($('#J_LookOver'), $('#J_LookOver').next());
    });
</script>
</body>
</html>
